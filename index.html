<!DOCTYPE html>
<html>

<head>
   <link rel="stylesheet" href="style.css">
     <meta name="viewport" content="width=device-width, initial-scale=1">
     <title>atm refracter</title>
</head>

<body>
    <div class="hero-image">
        
      </div>
<br>
<br>
<br>
    <div id="start"> 
       
        
        <label>Input Your PIN:</label>
        <input id="pinput"></input>
        <button onclick="login()">Submit</button>
        <p id="account"></p>

        <label>New Account:</label>
        <input id="newpinput"></input>
        <button onclick="newAccount()">Submit</button>
    </div>

    <div id="menu" style="display:none"> 
        <button onclick="displayBalance()">Get Balance</button>
        <p id="balance"></p>

        <button onclick="displayWithrawal()">Withdrawal</button>

        <button onclick="displayDeposit()">Deposit</button>
<!---added change pin button//-->
        <button onclick="displayChangePin()">Change PIN</button>
       
        <button onclick="returnToMenu()">Logout</button>
      
    </div>

    <script>
          alert ("WELCOME! Please Have your PIN number available to access your account.");
       

        /*----------- the code to manipute data/ logic goes here --------*/ 
        class Atm {
            constructor(){
            this.accounts = [];
             //[Account, Account, Account]	
                /* Account { 	
                    pin : 1283	
                    balance: 0	
                    deposit : function	
                    withdrawal : function	
                } */ 
            this.currentAccount = null; 
            }
            createAccount (pin){
                    let newAccount = new Account(pin);
                    this.accounts.push(newAccount);
                    this.currentAccount = newAccount; 
                    updateATM(); 
                    return newAccount; 
            };

            updateAccount (newPin){
               // let arrAccount = atm.getAccount(atm.currentAccount.pin);
                 //   atm.accounts[currentAcct.index].pin = pin;  
                for (let i = 0; i < this.accounts.length; i++) {
                    if (this.accounts[i].pin === this.currentAccount.pin) {
                        //return the bank account that matches our pin
                        this.currentAccount.changePin(newPin); 
                        this.accounts[i] = this.currentAccount; 
                        updateATM(); 

                    }
                }
            }

            getAccount (pin){
                for (let i = 0; i < this.accounts.length; i++) {
                    if (this.accounts[i].pin === pin) {
                        //return the bank account that matches our pin
                        this.currentAccount = this.accounts[i]; 
                        updateATM(); 
                        return this.accounts[i];
                    }
                }
                return null; 
            }; 
        }

        class Account { 
            constructor (pin){
                //let this = {};
            this.pin = pin;
            this.balance = 0;
             //return this; 
            }

            //withdrawal
            withdrawal (wdAmount){
                this.balance = this.balance - wdAmount; 
                updateATM(); 
            }

            //deposit 
            deposit (depAmount){
                this.balance = this.balance + depAmount;
                updateATM(); 
            }
            //change pin
            changePin (newPin){
                this.pin = newPin;
                updateATM();
            }
//return this;
        }
 /* When the page loads get the ATM accounts out of local storage */ 
 let atm = new Atm(); 
        atm.accounts = JSON.parse(localStorage.getItem("atm_accts")); 
        /* if there are no accounts, make sure we initialize with an empty array */
        if(atm.accounts === null){
            atm.accounts = []; 
        
        }

        function updateATM(){ 
            console.log(atm.accounts);
            localStorage.setItem("atm_accts",  JSON.stringify(atm.accounts) ); 
        }

        /*-------------  UI side/display logic ------------------------*/ 
        /*------------- The methods to manipulate UI go here ----------*/
        
        //display login
        function returnToMenu(){
            /* clear the fields in the menu */ 
            document.getElementById("balance").innerHTML = null;

            /* hide the menu and display the login */ 
            document.getElementById("menu").style.display = "none";
            document.getElementById("start").style.display = "block";
            
            /* clear current account */ 
            atm.currentAccount = null; 
        }

        function displayBalance() { 
            document.getElementById("balance").innerHTML = 
            atm.currentAccount.balance; 
        }

        function displayWithrawal() {
            //fee alert
            //get the amount to withdraw
            //convert the amount to a number
            //putting it in the amount variable
            alert("You may be charged a fee for withdrawing cash from this ATM")
            let amount = Number(prompt("How much would you like to withdraw?", ""));
            //withdraws the money
            //call into the atm object
            //access the current account property which is an object of the account
            //access that objects withdrawal method
            //pass the parameter "amount"
            if(amountValid("w", amount)){
            atm.currentAccount.withdrawal(amount); 
            //display the balance
            displayBalance(); 
           
        }
        else {
            alert("Amount must be <==$200 and in increments of $20.")
                }
            }
       //error resolved0-the whole page stopped bc there was a 3rd end bracket on this line-->
        function displayDeposit() {
            let amount = Number(prompt("How much would you like to deposit?", ""));
            if(amountValid("d", amount)) {
                atm.currentAccount.deposit(amount);
                displayBalance();
            }
            else {
                alert("Amount must be <==$200 and in increments of $20.")
            }
        }
        function amountValid(type, amount){
            //any time you want to add error checking to with/dep functions
            //add it here. 
            let val = true; 
            //make sure amount is <= 200 
            if(amount > 200){
                val = false; 
            }
            //make sure amount is in increments of 20 
            if(amount % 20 != 0){
                val = false; 
            }
            //withdrawal specific error checking  
            if(type === "w" ){
                if(amount > atm.currentAccount.balance){
                    val = false; 
                }
                //new withdrawal error checking happens here 
            }

            return(val); 
        }

function newAccount(){
        let pin = parseInt(document.getElementById("newpinput").value);
        if(pin <= 9999 && pin >= 1000){
            if(atm.getAccount(pin) != null){
                alert("This account already exists!"); 
            } else {
                atm.createAccount(pin);
                displayMenu(); 
            } 
        } 
        else {
            alert("Your pin needs to be 4 numbers."); 
        }
    }

        function login() {
            let pin = parseInt(document.getElementById("pinput").value);
           let acct = atm.getAccount(pin);
           if (acct === null){
                alert("Invalid PIN!"); 
            } else {
                atm.currentAccount = acct;
                displayMenu(); 
            }
        }
        
        function displayMenu(){
           
            /* clear the fields in the menu */ 
            document.getElementById("pinput").value = null; 
            document.getElementById("newpinput").value = null; 

            /* hide the login and display the menu */ 
            document.getElementById("start").style.display = "none";
            document.getElementById("menu").style.display = "block";
        }

        function displayChangePin(){
            //we're going to have to have to update a pin to a specific account with a new pin...get the new pin
            //see if it exits ... call our getAccount(pin)
            //if the account is null update the pin otherwise dont
            let pin = Number(prompt("Please Enter Your New PIN", ""));
            //if the pin already exists call our atm.getAccount(pin)
            if(atm.getAccount(pin) ===null) {
                //change the pin in tyhe current account
                atm.updateAccount(pin);
            } else {
                alert("This PIN is already in use. Please Choose another PIN!");
            }

        }
     
    </script>
<br>
<br>
<br>
<br>
<br>
   <!---test <script type="text/javascript"> 
        var myDate = new Date(); 
        var myDay = myDate.getDay(); 
        
        // Array of days. 
        var weekday = ['Sunday', 'Monday', 'Tuesday', 
            'Wednesday', 'Thursday', 'Friday', 'Saturday' 
        ]; 
        document.write("Today is : " + weekday[myDay]); 
        document.write("<br/>"); 
        
        // get hour value. 
        var hours = myDate.getHours(); 
        var ampm = hours >= 12 ? 'PM' : 'AM'; 
        hours = hours % 12; 
        hours = hours ? hours : 12; 
        var minutes = myDate.getMinutes(); 
        minutes = minutes < 10 ? '0' + minutes : minutes; 
        var myTime = hours + " " + ampm + " : " + minutes +  
            " : " + myDate.getMilliseconds(); 
        document.write("\tCurrent time is : " + myTime); 
    </script> -->


</body>

</html>